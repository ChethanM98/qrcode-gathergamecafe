<!DOCTYPE html>
<html>
<head>
<title>Kitchen Display</title>

<style>
body {
  font-family: Arial;
  background:#1e1e1e;
  color:#fff;
  padding:20px;
}

.order {
  background:#fff;
  color:#000;
  padding:20px;
  margin-bottom:16px;
  border-radius:10px;
  border-left:8px solid #f39c12;
  page-break-inside: avoid;
}

.order h2 {
  margin:0 0 10px 0;
}

.item {
  display:flex;
  justify-content:space-between;
  margin:6px 0;
  font-size:16px;
}

.actions {
  margin-top:12px;
}

select, button {
  width:100%;
  padding:8px;
  font-size:14px;
  margin-top:6px;
}

/* ===== PRINT ONLY ONE ORDER ===== */
@media print {
  body * {
    visibility: hidden;
  }

  .print-area, .print-area * {
    visibility: visible;
  }

  .print-area {
    position:absolute;
    left:0;
    top:0;
    width:80mm;       /* thermal friendly */
    font-size:12px;
  }

  select, button {
    display:none;
  }
}
</style>
</head>

<body>

<h1>üë®‚Äçüç≥ Kitchen Orders</h1>
<div id="list"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const QUEUE_KEY = "kitchen_queue";
  const list = document.getElementById("list");

  load();
  setInterval(load, 5000);

  function load() {
    const queue = JSON.parse(localStorage.getItem(QUEUE_KEY)) || [];
    list.innerHTML = "";

    if (queue.length === 0) {
      list.innerHTML = "<p>No pending orders</p>";
      return;
    }

    queue.forEach((order, index) => {
      let itemsHTML = "";

      for (const k in order.items) {
        const i = order.items[k];
        itemsHTML += `
          <div class="item">
            <span>${i.name} √ó ${i.qty}</span>
          </div>
        `;
      }

      list.innerHTML += `
        <div class="order print-area">
          <h2>Table ${order.table}</h2>
          <div>‚è± ${order.time}</div>

          ${itemsHTML}

          <div class="actions">
            <button onclick="printThis(this)">üñ® Print</button>

            <select onchange="markServed(${index})">
              <option value="">Pending</option>
              <option value="Served">Served</option>
            </select>
          </div>
        </div>
      `;
    });
  }

  /* ===== MARK SERVED ===== */
  window.markServed = index => {
    let queue = JSON.parse(localStorage.getItem(QUEUE_KEY)) || [];
    queue.splice(index, 1);
    localStorage.setItem(QUEUE_KEY, JSON.stringify(queue));
    load();
  };

  /* ===== PRINT ONLY THIS ORDER ===== */
  window.printThis = function (btn) {
    const box = btn.closest(".order");
    document.querySelectorAll(".order").forEach(o => {
      if (o !== box) o.style.display = "none";
    });

    window.print();

    document.querySelectorAll(".order").forEach(o => {
      o.style.display = "";
    });
  };

});
</script>

</body>
</html>
