<!DOCTYPE html>
<html>
<head>
<title>Kitchen Display</title>

<style>
body {
  font-family: Arial;
  background:#1e1e1e;
  color:#fff;
  padding:20px;
}

.order {
  background:#fff;
  color:#000;
  padding:20px;
  margin-bottom:16px;
  border-radius:10px;
  border-left:8px solid #f39c12;
}

.order h2 {
  margin:0 0 8px 0;
}

.time {
  font-size:13px;
  color:#555;
  margin-bottom:8px;
}

.item {
  display:flex;
  justify-content:space-between;
  margin:6px 0;
  font-size:16px;
}

.actions {
  margin-top:12px;
  display:flex;
  gap:10px;
}

button, select {
  flex:1;
  padding:10px;
  font-size:14px;
  cursor:pointer;
}

/* ===== PRINT ONLY ONE ORDER ===== */
@media print {
  body * {
    visibility: hidden;
  }

  .print-area, .print-area * {
    visibility: visible;
  }

  .print-area {
    position:absolute;
    left:0;
    top:0;
    width:80mm;
    font-size:12px;
  }

  button, select {
    display:none;
  }
}
</style>
</head>

<body>

<h1>üë®‚Äçüç≥ Kitchen Orders</h1>
<div id="list"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const QUEUE_KEY = "kitchen_queue";
  const list = document.getElementById("list");

  load();
  setInterval(load, 5000);

  function load() {
    const queue = JSON.parse(localStorage.getItem(QUEUE_KEY)) || [];
    list.innerHTML = "";

    if (queue.length === 0) {
      list.innerHTML = "<p>No pending orders</p>";
      return;
    }

    queue.forEach((order, index) => {

      let itemsHTML = "";
      for (const k in order.items) {
        const i = order.items[k];
        itemsHTML += `
          <div class="item">
            <span>${i.name} √ó ${i.qty}</span>
          </div>`;
      }

      list.innerHTML += `
        <div class="order print-area" data-index="${index}">
          <h2>Table ${order.table}</h2>
          <div class="time">‚è± ${order.time}</div>

          ${itemsHTML}

          <div class="actions">
            <button onclick="printAndServe(${index}, this)">
              üñ® Print
            </button>

            <select onchange="markServed(${index})">
              <option value="">Pending</option>
              <option value="Served">Served</option>
            </select>
          </div>
        </div>
      `;
    });
  }

  /* ===== PRINT ‚Üí AUTO REMOVE ===== */
  window.printAndServe = function (index, btn) {

    const box = btn.closest(".order");

    // Hide other orders
    document.querySelectorAll(".order").forEach(o => {
      if (o !== box) o.style.display = "none";
    });

    window.print();

    // Remove order after print
    let queue = JSON.parse(localStorage.getItem(QUEUE_KEY)) || [];
    queue.splice(index, 1);
    localStorage.setItem(QUEUE_KEY, JSON.stringify(queue));

    // Restore UI
    load();
  };

  /* ===== MANUAL SERVED ===== */
  window.markServed = function (index) {
    let queue = JSON.parse(localStorage.getItem(QUEUE_KEY)) || [];
    queue.splice(index, 1);
    localStorage.setItem(QUEUE_KEY, JSON.stringify(queue));
    load();
  };

});
</script>

</body>
</html>
