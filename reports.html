<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reports</title>

<!-- üîê AUTH -->
<script>
(function () {
  const auth = localStorage.getItem("admin_auth");
  const time = localStorage.getItem("admin_auth_time");

  if (!auth || !time || Date.now() - time > 30 * 60 * 1000) {
    localStorage.removeItem("admin_auth");
    localStorage.removeItem("admin_auth_time");
    location.href = "admin-login.html?redirect=reports.html";
  }
})();
</script>

<style>
body {
  font-family: Arial;
  background:#f6f1e7;
  padding:20px;
}

.container {
  max-width: 900px;
  margin:auto;
}

button {
  padding:10px 14px;
  margin:6px 0;
  border:none;
  border-radius:999px;
  background:#3fa55b;
  color:#fff;
  cursor:pointer;
}

.block {
  background:#fff;
  padding:16px;
  border-radius:10px;
  margin-top:16px;
}

.bill {
  border-bottom:1px dashed #ccc;
  padding:10px 0;
}

.item {
  display:flex;
  justify-content:space-between;
  font-size:14px;
}

.total {
  font-weight:bold;
  text-align:right;
  margin-top:6px;
}

.summary {
  font-size:16px;
  font-weight:bold;
  margin-top:10px;
}
</style>
</head>

<body>

<div class="container">
  <h1>üìä Reports</h1>

  <!-- ===== QUICK REPORTS ===== -->
  <div class="block">
    <button onclick="dailyReport()">üìÖ Daily Report</button>
    <button onclick="monthlyReport()">üìÜ Monthly Report</button>
    <button onclick="monthlySummary()">üìä Monthly Summary</button>
    <div id="quickReport"></div>
  </div>

  <!-- ===== DATE FILTER ===== -->
  <div class="block">
    <h3>üîç Date Filter</h3>
    From <input type="date" id="from">
    To <input type="date" id="to">
    <button onclick="dateFilter()">Apply</button>
  </div>

  <!-- ===== DETAILED REPORTS ===== -->
  <div class="block" id="detailed"></div>

  <!-- ===== TOTAL SUMMARY ===== -->
  <div class="block summary" id="grandTotal"></div>

  <button onclick="logout()">Logout</button>
</div>

<script>
const CLOSED_KEY = "closed_bills";

/* ===== DAILY ===== */
function dailyReport() {
  const today = new Date().toDateString();
  const bills = JSON.parse(localStorage.getItem(CLOSED_KEY)) || [];
  let total = 0;

  bills.filter(b => new Date(b.time).toDateString() === today)
    .forEach(b => total += b.total);

  document.getElementById("quickReport").innerHTML =
    `Today‚Äôs Total: ‚Çπ${total.toFixed(2)}`;
}

/* ===== MONTHLY ===== */
function monthlyReport() {
  const m = new Date().getMonth();
  const y = new Date().getFullYear();
  const bills = JSON.parse(localStorage.getItem(CLOSED_KEY)) || [];
  let total = 0;

  bills.filter(b => {
    const d = new Date(b.time);
    return d.getMonth() === m && d.getFullYear() === y;
  }).forEach(b => total += b.total);

  document.getElementById("quickReport").innerHTML =
    `This Month Total: ‚Çπ${total.toFixed(2)}`;
}

/* ===== MONTHLY SUMMARY (DAY-WISE) ===== */
function monthlySummary() {
  const m = new Date().getMonth();
  const y = new Date().getFullYear();
  const bills = JSON.parse(localStorage.getItem(CLOSED_KEY)) || {};
  const map = {};

  bills.forEach(b => {
    const d = new Date(b.time);
    if (d.getMonth() === m && d.getFullYear() === y) {
      const day = d.toDateString();
      map[day] = (map[day] || 0) + b.total;
    }
  });

  let html = "<h4>Day-wise Summary</h4>";
  for (const day in map) {
    html += `<div>${day} : ‚Çπ${map[day].toFixed(2)}</div>`;
  }

  document.getElementById("quickReport").innerHTML = html;
}

/* ===== DATE FILTER (DETAILED) ===== */
function dateFilter() {
  const from = new Date(document.getElementById("from").value);
  const to = new Date(document.getElementById("to").value);
  to.setHours(23,59,59,999);

  const bills = JSON.parse(localStorage.getItem(CLOSED_KEY)) || [];
  const div = document.getElementById("detailed");
  const totalDiv = document.getElementById("grandTotal");

  div.innerHTML = "";
  totalDiv.innerHTML = "";
  let grand = 0;

  bills.filter(b => {
    const d = new Date(b.time);
    return d >= from && d <= to;
  }).forEach(b => {

    let itemsHTML = "";
    for (const k in b.items) {
      const i = b.items[k];
      itemsHTML += `
        <div class="item">
          <span>${i.name} √ó ${i.qty}</span>
          <span>‚Çπ${i.price * i.qty}</span>
        </div>`;
    }

    grand += b.total;

    div.innerHTML += `
      <div class="bill">
        <b>Table ${b.table}</b>
        ${itemsHTML}
        <div class="total">‚Çπ${b.total.toFixed(2)}</div>
      </div>
    `;
  });

  totalDiv.innerHTML = `Grand Total: ‚Çπ${grand.toFixed(2)}`;
}

/* ===== LOGOUT ===== */
function logout() {
  localStorage.removeItem("admin_auth");
  localStorage.removeItem("admin_auth_time");
  location.href = "admin-login.html";
}
</script>

</body>
</html>
