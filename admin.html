<!DOCTYPE html>
<html>
<head>
<title>Kitchen & Billing</title>

<style>
body { font-family: Arial; background:#f2f2f2; padding:20px; }

.order-box {
  background:#fff;
  padding:16px;
  margin-bottom:20px;
  border-radius:10px;
  border:2px solid #333;
}

.table-title {
  font-size:18px;
  font-weight:bold;
}

.items {
  margin:10px 0;
}

.item-row {
  display:flex;
  justify-content:space-between;
  margin:6px 0;
}

.total {
  text-align:right;
  font-weight:bold;
  margin-top:8px;
}

.actions {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:12px;
}

select, button {
  padding:8px 12px;
}

.print-btn { background:#7b4b2a; color:#fff; border:none; }
.close-btn { background:#3fa55b; color:#fff; border:none; }

@media print {
  body * { visibility:hidden; }
  .order-box, .order-box * { visibility:visible; }
  .order-box { position:absolute; left:0; top:0; width:100%; }
}
</style>
</head>

<body>

<h1>üçΩÔ∏è Kitchen & Billing</h1>
<div id="orders"></div>

<h2>üìä Reports</h2>
<button onclick="exportDailySummaryExcel()">üìÖ Day-wise Excel</button>
<button onclick="exportMonthlyExcel()">üìÜ Monthly Excel</button>
<button onclick="loadMonthly()">üìä Monthly Summary (Screen)</button>
<div id="report"></div>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const KITCHEN_KEY = "kitchen_orders";
  const ordersDiv = document.getElementById("orders");

  loadOrders();

  function loadOrders() {
    const orders = JSON.parse(localStorage.getItem(KITCHEN_KEY)) || [];
    ordersDiv.innerHTML = "";

    const openOrders = orders.filter(o => o.status === "Open");

    if (openOrders.length === 0) {
      ordersDiv.innerHTML = "<p>No open orders</p>";
      return;
    }

    openOrders.forEach((order, index) => {
      let itemsHTML = "";
      let total = 0;

      for (const key in order.items) {
  const item = order.items[key];
  const lineTotal = item.price * item.qty;

  itemsHTML += `
    <div class="item-row">
      <span>${item.name} √ó ${item.qty}</span>
      <span>‚Çπ${lineTotal}</span>
    </div>
  `;
}

      ordersDiv.innerHTML += `
        <div class="order-box">
          <div class="table-title">Table ${order.table}</div>

          <div class="items">
            ${itemsHTML}
            <div class="total">Total: ‚Çπ${total}</div>
          </div>

          <div class="actions">
            <div>
              Payment:
              <select onchange="setPayment('${order.table}', this.value)">
                <option value="">Select</option>
                <option value="Cash" ${order.payment==="Cash"?"selected":""}>Cash</option>
                <option value="UPI" ${order.payment==="UPI"?"selected":""}>UPI</option>
              </select>
            </div>

            <div>
              <button class="print-btn" onclick="printBill()">Print Bill</button>
              <button class="close-btn" onclick="closeBill('${order.table}')">
                Close Bill
              </button>
            </div>
          </div>
        </div>
      `;
    });
  }

  window.setPayment = function (table, method) {
    const orders = JSON.parse(localStorage.getItem(KITCHEN_KEY)) || [];
    const order = orders.find(o => o.table === table && o.status === "Open");
    if (order) {
      order.payment = method;
      localStorage.setItem(KITCHEN_KEY, JSON.stringify(orders));
    }
  };

  window.closeBill = function (table) {
    const orders = JSON.parse(localStorage.getItem(KITCHEN_KEY)) || [];
    const index = orders.findIndex(o => o.table === table && o.status === "Open");

    if (index === -1) return;

    if (!orders[index].payment) {
      alert("Select payment method before closing bill");
      return;
    }

    orders.splice(index, 1); // close order
    localStorage.setItem(KITCHEN_KEY, JSON.stringify(orders));
    loadOrders();
  };

  window.printBill = function () {
    window.print();
  };

});
</script>

</body>
</html>

