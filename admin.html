<!DOCTYPE html>
<html>
<head>
<title>Admin POS</title>
<style>
body { font-family: Arial; background:#f2f2f2; }
.table-box {
  background:#fff;
  padding:14px;
  margin:14px;
  border:2px solid #333;
}
.invoice {
  border:1px solid #000;
  padding:10px;
  margin-top:10px;
}
.line {
  display:flex;
  justify-content:space-between;
}
button, select {
  margin-top:6px;
  padding:6px 10px;
}
@media print {
  body * { visibility:hidden; }
  .invoice, .invoice * { visibility:visible; }
}
</style>
</head>

<body>

<h1>üçΩÔ∏è Kitchen & Billing</h1>
<div id="orders"></div>

<h2>üìä Reports</h2>
<button onclick="exportDailySummaryExcel()">üìÖ Day-wise Excel</button>
<button onclick="exportMonthlyExcel()">üìÜ Monthly Excel</button>
<button onclick="loadMonthly()">üìä Monthly Summary (Screen)</button>
<div id="report"></div>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const KITCHEN_KEY = "kitchen_orders";
  const ordersDiv = document.getElementById("orders");

  loadKitchenOrders();

  function loadKitchenOrders() {
    const orders =
      JSON.parse(localStorage.getItem(KITCHEN_KEY)) || [];

    ordersDiv.innerHTML = "";

    if (orders.length === 0) {
      ordersDiv.innerHTML = "<p>No kitchen orders yet</p>";
      return;
    }

    orders.forEach((order, index) => {
      let itemsHtml = "";
      for (const name in order.items) {
        const item = order.items[name];
        itemsHtml += `
          <div class="line">
            <span>${name} √ó ${item.qty}</span>
            <span>‚Çπ${item.price * item.qty}</span>
          </div>
        `;
      }

      ordersDiv.innerHTML += `
        <div class="table-box">
          <strong>Table:</strong> ${order.table}<br>
          <strong>Time:</strong> ${order.time}<br>
          <strong>Status:</strong>
          <select onchange="updateStatus(${index}, this.value)">
            <option ${order.status==="New"?"selected":""}>New</option>
            <option ${order.status==="Preparing"?"selected":""}>Preparing</option>
            <option ${order.status==="Ready"?"selected":""}>Ready</option>
            <option ${order.status==="Served"?"selected":""}>Served</option>
          </select>

          <div class="invoice">
            ${itemsHtml}
            <hr>
            <div class="line">
              <strong>Total</strong>
              <strong>‚Çπ${order.total}</strong>
            </div>
          </div>

          <button onclick="printInvoice(this)">üñ®Ô∏è Print</button>
        </div>
      `;
    });
  }

  window.updateStatus = function (index, status) {
    const orders =
      JSON.parse(localStorage.getItem(KITCHEN_KEY)) || [];
    orders[index].status = status;
    localStorage.setItem(KITCHEN_KEY, JSON.stringify(orders));
    loadKitchenOrders();
  };

  window.printInvoice = function (btn) {
    btn.closest(".table-box")
       .querySelector(".invoice")
       .classList.add("print");
    window.print();
  };

});
</script>

</body>
</html>
